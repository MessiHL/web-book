

# 环境搭建

## 1 前端项目搭建一般流程

### 1.1 环境配置

 	详细步骤参考 [Webpack 4 教程：从零配置到生产发布（2018）](https://www.html.cn/archives/9436)， [webpack4.x最详细入门讲解](https://www.cnblogs.com/BetterMan-/p/9867642.html)

| 步骤             | 说明                                                   |
| ---------------- | ------------------------------------------------------ |
| 初始化项目       | npm init                                               |
| webpack环境安装  | webpack  webpack-cli  webpack-dev-server               |
| css安装预配置    | style-loader  css-loader ;      sass-loader  node-sass |
| babel 安装与配置 | babel-loader  babel-core  babel-preset                 |
| 文件/图片处理    | url-loader  file-loader                                |
| vue环境配置      | vue vue-loader  vue-template-complier                  |
|                  |                                                        |
|                  |                                                        |
|                  |                                                        |

#### 1.1.1 一些说明

**--save 和 --save-dev 的区别**

1. --save：将包安装到 dependencies ，简写是 **-S**；
2. --save-dev：将包安装到 devDependencies 简写是 **-D**。

**dependencies 和 devDependencies 的区别**

1. dependencies：运行时的依赖，即这个模块在生产环境下还需要使用；
2. devDependencies：开发时的依赖。即这个模块只是在开发时使用。

**webpack-cli 是什么**

webpack-cli 提供了一组灵活的命令，用于在设置自定义 webpack 项目时提高速度。也就是说你没有安装 webpack-cli，你是无法使用 webpack 命令的。



#### 1.1.2 项目初始化

```
npm init
```

#### 1.1.3 安装webpack4

```javascript
npm install webpack --save-dev
npm install webpack-cli  --save-dev
// 本地服务
npm install webpack-dev-server -D
```

文件目录设置

--luyuanweb -- 根目录

​	-- src

​		-- index.js

​	-- dist

​		-- index.html

配置 webpack.config.js 

```json
const path = require('path');
module.exports = {
    entry: path.join(__dirname, "/src/index.js"), // 入口文件
    output: {
        path: path.join( __dirname, "/dist"), //打包后的文件存放的地方
        filename: "bundle.js" //打包后输出文件的文件名
    },
    devServer: {
        contentBase: "./dist",   // 本地服务器所加载文件的目录
        port: "1234",  // 设置端口号为8888
        inline: true,  // 文件修改后实时刷新
        historyApiFallback: true, //设置为true，所有的跳转将指向index.html
        hot: true     //热加载
    },
}
```

package.json 中添加启动命令

```javascript
"scripts": {
    "dev": "webpack-dev-server --mode development --open",  //  本地服务器启动开发模式
    "build": "webpack --mode production", // 生产模式
  },
```

运行服务器

```javascript
npm run dev
	or
npm run build
```



#### 1.1.4 Loaders

webpack.config.js  下配置

| 配置             | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| test             | 一个用以匹配loaders所处理文件的拓展名的正则表达式（必须）    |
| loader           | loader的名称（必须）                                         |
| includer/exclude | 手动添加必须处理的文件（文件夹）或屏蔽不需要处理的文件（文件夹）（可选） |
| options          | 为loaders提供额外的设置选项                                  |

#### 1.1.5 样式

安装

```javascript
// 配置css
npm install style-loader  css-loader --save-dev
// 配置sass
npm install sass-loader node-sass --save-dev
```

webpack.config.js

```json
module: {
        rules: [
            {
                test: /\.css$/,
                use: [ 'style-loader', 'css-loader' ]
            },
            {
                test: /\.(scss|sass)$/,   // 正则匹配以.scss和.sass结尾的文件
                use: ['style-loader', 'css-loader', 'sass-loader']  // 需要用的loader，一定是这个顺序，因为调用loader是从右往左编译的
            }
        ]
    }
```



#### 1.1.6 Babel

babel7.x  安装与简单配置：

```javascript
npm install --save-dev  babel-loader@7 babel-core bebel-preset-es2015
// babel-preset-es2015: ES6转化到ES5
// 此安装无需在webpack.config.js 中配置，无需在.babelrc 中配置
// 但针对复杂的运用，还是需要单独配置
```

#### 1.1.7 图片/文件处理

```javascript
// 安装到开发环境
npm install --save-dev url-loader
// 处理文件（大图等）
npm install --save-dev file-loader
```

webpack.config.js中 rules下配置

```JSON
{
    test: /\.(png|jpg|jpeg|gif)$/,
    use: [
        {
            loader: 'url-loader',
            options: {
                // 8196 => 8KB
                // 使用的图片如果小于此配置，图片会被编译成base64
                // 图片大于此配置，则使用 file-loader
                limit: 8196,
                // 路径及名称配置：路径：dist(默认)/images; 名字：原文件名+hash值前八位+后缀名
                name:'images/[name][hash:8].[ext]'
            }
        }
    ]
}
```

#### 1.1.8 vue

参考[webpack4自己动手配置vue](https://www.jianshu.com/p/c24e27d896d0)。   安装(注意 安装方式  --save  和 --save-dev）：

```javascript
npm install vue --save
npm install vue-loader  --save-dev
npm install vue-template-compiler --save-dev
```

webpack.config.js配置：

```javascript
var htmlWebpackPlugin = require('html-webpack-plugin');//引入html模板模块
//webpack4配置需要包含VueLoaderPlugin,
//在输出里面配置plugins:{new VueLoaderPlugin()}
//否则会报错
 const VueLoaderPlugin = require('vue-loader/lib/plugin');
 module.exports = {
    module:{
        rules:[
            {
                test:/\.vue$/,
                use:['vue-loader'],
            }
        ]
    },
    plugins:[
        new htmlWebpackPlugin({
            title:"首页",
            template:'./index.html'
        }),
        new VueLoaderPlugin()
    ]
 }
```

./index.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="app">
        
    </div>
</body>
</html>
```

./src/App.vue 文件

```vue
<template>
  <div>
    <h1>hellow word</h1>
    <h2>{{ msg }}</h2>
  </div>
</template>
<script>
    export default {
        data() {
            return {
                msg: 'welcome Vue'
            }
        }
    }
</script>
<style>
  body{
    background-color: #ccc;
  }
```

入口文件 ./index.js

```javascript
import Vue from "vue"; //引入vue文件
import App from "./src/App.vue" // 引入模板文件

//创建vue实例并且将其挂在到app节点上
new Vue({ 
    el:'#app',
    render:(h)=>h(App)
})
```



## 3 Scss

## 4 wabpack4

参考资料：[webpack中文网](https://www.webpackjs.com/)

### 4.1 webpack.config.js

```javascript
/**
 * entry: 
 *  入口起点(entry point)指示 webpack 应该使用哪个模块，来作为构建其内部依赖图的开始。
 *  进入入口起点后，webpack 会找出有哪些模块和库是入口起点（直接和间接）依赖的。
 *  每个依赖项随即被处理，最后输出到称之为 bundles 的文件中。
 * 
 * output：
 *   该属性告诉 webpack 在哪里输出它所创建的 bundles，以及如何命名这些文件，默认值为 ./dist。
 *   基本上，整个应用程序结构，都会被编译到你指定的输出路径的文件夹中。
 * 
 * loader:
 *   让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。
 *   loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，
 *   对它们进行处理。本质上，webpack loader 将所有类型的文件，
 *   转换为应用程序的依赖图（和最终的 bundle）可以直接引用的模块。
 *   在 webpack 的配置中 loader 有两个目标
 *     1- test 属性，用于标识出应该被对应的 loader 进行转换的某个或某些文件。
 *     2- use 属性，表示进行转换时，应该使用哪个 loader。
 * plugins:
 *   插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。
 *   插件接口功能极其强大，可以用来处理各种各样的任务。 
 * 
 *   想要使用一个插件，你只需要 require() 它，然后把它添加到 plugins 数组中。
 *   多数插件可以通过选项(option)自定义。你也可以在一个配置文件中因为不同目的而多次使用同一个插件，
 *   这时需要通过使用 new 操作符来创建它的一个实例。
 *
 *  mode:
 *   通过选择 development 或 production 之中的一个，来设置 mode 参数，
 *   你可以启用相应模式下的 webpack 内置的优化
 */

const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin'); // 通过 npm 安装
module.exports = {
    mode: 'production',
    entry:'./src/index.js', 
    output: {
        path: path.resolve(__dirname, 'dist'),
        filename: 'bundle.js'
    },
    module: {
        rules: [
            { test: /\.txt$/, use: 'raw-loader' }
        ]
    },
    plugins: [
        new HtmlWebpackPlugin({template: './src/index.html'})
    ]
};
```

### 4.2 mode

```javascript
module.exports = {
  mode: 'production'
};
```



| 模式        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| development | 会将 `process.env.NODE_ENV` 的值设为 `development`。<br />启用 `NamedChunksPlugin` 和 `NamedModulesPlugin`。 |
| production  | 会将 `process.env.NODE_ENV` 的值设为 `production`。启用 `FlagDependencyUsagePlugin`, `FlagIncludedChunksPlugin`, `ModuleConcatenationPlugin`, `NoEmitOnErrorsPlugin`, `OccurrenceOrderPlugin`, `SideEffectsFlagPlugin` 和 `UglifyJsPlugin`. |

```diff
// webpack.development.config.js
module.exports = {
+ mode: 'development'
- plugins: [
-   new webpack.NamedModulesPlugin(),
-   new webpack.DefinePlugin({ "process.env.NODE_ENV": JSON.stringify("development") }),
- ]
}
```

```diff
// webpack.production.config.js
module.exports = {
+  mode: 'production',
-  plugins: [
-    new UglifyJsPlugin(/* ... */),
-    new webpack.DefinePlugin({ "process.env.NODE_ENV": JSON.stringify("production") }),
-    new webpack.optimize.ModuleConcatenationPlugin(),
-    new webpack.NoEmitOnErrorsPlugin()
-  ]
}
```

### 4.3 loader

​        loader 用于对模块的源代码进行转换。loader 可以使你在 `import` 或"加载"模块时预处理文件。因此，loader 类似于其他构建工具中“任务(task)”，并提供了处理前端构建步骤的强大方法。loader 可以将文件从不同的语言（如 TypeScript）转换为 JavaScript，或将内联图像转换为 data URL。loader 甚至允许你直接在 JavaScript 模块中 `import` CSS文件！

特性：

- loader 支持链式传递。能够对资源使用流水线(pipeline)。一组链式的 loader 将按照相反的顺序执行。loader 链中的第一个 loader 返回值给下一个 loader。在最后一个 loader，返回 webpack 所预期的 JavaScript。
- loader 可以是同步的，也可以是异步的。
- loader 运行在 Node.js 中，并且能够执行任何可能的操作。
- loader 接收查询参数。用于对 loader 传递配置。
- loader 也能够使用 `options` 对象进行配置。
- 除了使用 `package.json` 常见的 `main` 属性，还可以将普通的 npm 模块导出为 loader，做法是在 `package.json` 里定义一个 `loader` 字段。
- 插件(plugin)可以为 loader 带来更多特性。
- loader 能够产生额外的任意文件。

## 5 package.json

参考资料：  [npm-package.json](https://docs.npmjs.com/configuring-npm/package-json.html)   [package.json](https://npmjs.org/doc/files/package.json.html)

```javascript
{
    "name": "asset_manage",  //项目名称
    "version": "0.1.0",  //项目版本
    "author":"作者"
    "description"："项目描述",
    "scripts": {   //npm快捷执行命令脚本配置
        
    },
    "dependencies": {  //生产环境依赖
        
    },
    "devDependencies":{ //开发环境依赖
 
    },
    "eslintConfig": {  //eslint配置
        
    },
    "browserslist": [  //项目浏览器兼容配置
        "> 1%",
        "last 2 versions",
        "not ie <= 8"
    ]
}
```

## 6  vue.config.js

[官网：配置说明](https://cli.vuejs.org/zh/config/)

```javascript
const path = require('path')
const CompressionPlugin = require("compression-webpack-plugin")

function resolve(dir) {
  return path.join(__dirname, dir)
}

// vue.config.js
module.exports = {
  /*
    Vue-cli3:
    Crashed when using Webpack `import()` #2463
    https://github.com/vuejs/vue-cli/issues/2463
   */
  // 如果你不需要生产环境的 source map，可以将其设置为 false 以加速生产环境构建。
  productionSourceMap: false,


  //打包app时放开该配置
  //publicPath:'./',
  configureWebpack: config => {
    //生产环境取消 console.log
    if (process.env.NODE_ENV === 'production') {
      config.optimization.minimizer[0].options.terserOptions.compress.drop_console = true
    }
  },
  chainWebpack: (config) => {
    // 项目文件路径别名
    config.resolve.alias
      .set('@$', resolve('src'))
      .set('@api', resolve('src/api'))
      .set('@assets', resolve('src/assets'))
      .set('@comp', resolve('src/components'))
      .set('@views', resolve('src/views'))
      .set('@layout', resolve('src/layout'))
      .set('@static', resolve('src/static'))
      .set('@mobile', resolve('src/modules/mobile'))

    //生产环境，开启js\css压缩
    if (process.env.NODE_ENV === 'production') {
        config.plugin('compressionPlugin').use(new CompressionPlugin({
          test: /\.js$|.\css|.\less/, // 匹配文件名
          threshold: 10240, // 对超过10k的数据压缩
          deleteOriginalAssets: false // 不删除源文件
        }))
    }

    // 配置 webpack 识别 markdown 为普通的文件
    config.module
      .rule('markdown')
      .test(/\.md$/)
      .use()
      .loader('file-loader')
      .end()
  },

  css: {
    loaderOptions: {
      less: {
        modifyVars: {
          /* less 变量覆盖，用于自定义 ant design 主题 */
          'primary-color': '#1890FF',
          'link-color': '#1890FF',
          'border-radius-base': '4px',
        },
        javascriptEnabled: true,
      }
    }
  },

  devServer: {
    port: 3000,
    proxy: {
      '/jeecg-boot': {
        target: 'http://localhost:8080', //请求本地 需要jeecg-boot后台项目
        ws: false,
        changeOrigin: true
      },
    }
  },

  lintOnSave: undefined
}
```

## 7 Plugins

### 1 vue-count-to

vue-countTo是一个无依赖，轻量级的vue组件，可以自行覆盖easingFn。

你可以设置 startVal 和 endVal，它会自动判断计数或倒计时。支持vue-ssr。vue-countTo参考于countUp.js;

**核心是HTML5的API :  requestAnimationFrame 、 cancelAnimationFrame**

```html
<!DOCTYPE html>
<html>
 
    <head>
        <meta charset="UTF-8">
        <title></title>
        <script type="text/javascript">
            window.onload = function() {
 
                var id = null;
                var i=0;
                function a(time) {
                    console.log(i++);
                    id = window.requestAnimationFrame(a);
             
                }
                function b(){
                    window.cancelAnimationFrame(id);
                }
                document.getElementById("start").onclick=a;   //相当开始
                document.getElementById("zantin").onclick=b;   //相当暂停
            }
        </script>
    </head>
 
    <body>
        <button id="start">开始</button>
        <button id="zantin">暂停</button>
    </body>
 
</html>
```



```js
// 安装
npm install vue-count-to
```

**选项**

| Property  | Description            | type     | default |
| --------- | ---------------------- | -------- | ------- |
| startVal  | 开始值                 | Number   | 0       |
| endVal    | 结束值                 | Number   | 2017    |
| duration  | 持续时间，以毫秒为单位 | Number   | 3000    |
| autoplay  | 自动播放               | Boolean  | true    |
| decimals  | 要显示的小数位数       | Number   | 0       |
| decimal   | 十进制分割             | String   | .       |
| separator | 分隔符                 | String   | ,       |
| prefix    | 前缀                   | String   | ''      |
| suffix    | 后缀                   | String   | ''      |
| useEasing | 使用缓和功能           | Boolean  | true    |
| easingFn  | 缓和回调               | Function | —       |

**注意：当autoplay：true时，它将在startVal或endVal更改时自动启动**

**功能**

|  Function Name  |   Description    |
| :-------------: | :--------------: |
| mountedCallback | 挂载以后返回回调 |
|      start      |     开始计数     |
|      pause      |     暂停计数     |
|      reset      |   重置countTo    |

### 2 svg-icon

[参考资料](https://www.jianshu.com/p/550ab0dafd91)  [svgo](https://github.com/svg/svgo)

 1 安装：svg-sprite-loader   svgo。

 2 webpack配置（注意url-loader 中的 exclude）：

```json
  {
      test: /\.svg$/,
        loader: 'svg-sprite-loader',
        include: [resolve('src/icons')],
        options: {
          symbolId: 'icon-[name]'
        }
      },
      {
        test: /\.(png|jpe?g|gif|svg)(\?.*)?$/,
        loader: 'url-loader',
        options: {
          limit: 10000,
          name: utils.assetsPath('img/[name].[hash:7].[ext]')
        },
        // 注意这里，使用 svg-sprite-loader 专门处理.svg文件
        exclude: [resolve('src/icons')]
      },
```

### 3 compression-webpack-plugin

[官网](https://www.webpackjs.com/plugins/compression-webpack-plugin/)

 提供带 Content-Encoding 编码的压缩版的资源 

